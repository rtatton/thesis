\chapter{Risk Propagation}\label{ch:risk-propagation}

Risk propagation is a message-passing algorithm that estimates an individual's infection risk by considering their demographics, symptoms, diagnosis, and contact with others. Formally, a \define{risk score} $\vScore_t$ is a timestamped infection probability where $\vScore \in [0, 1]$ and $t \in \naturals$ is the time of its computation. Thus, an individual with a high risk score is likely to test positive for the infection and poses a significant health risk to others. There are two types of risk scores: \define{symptom scores}, or prior infection probabilities, which account for an individual's demographics, symptoms, and diagnosis \citep{Menni2020}; and \define{exposure scores}, or posterior infection probabilities, which incorporate the risk of direct and indirect contact with others.

Given their recent risk scores and contacts, an individual's exposure score is derived by marginalizing over the joint infection probability distribution. Naively computing this marginalization scales exponentially with the number of variables (i.e., individuals). To circumvent this intractability, the joint distribution is modeled as a factor graph, and an efficient message-passing procedure is employed to compute the marginal probabilities with a time complexity that scales linearly in the number of factor nodes (i.e., contacts).

Let $\vGraph = (\vVariables, \vFactors, \vEdges)$ be a \define{factor graph} where $\vVariables$ is the set of variable nodes, $\vFactors$ is the set of factor nodes, and $\vEdges$ is the set of edges incident between them \citep{Kschischang2001}. A \define{variable node}
%
\begin{equation*}
   \vVariable: \eventSpace \rightarrow \{0, 1\} 
\end{equation*}
%Ã¥
is a random variable that represents the infection status of an individual, where the sample space is $\eventSpace = \{\var{healthy}, \var{infected}\}$ and
%
\begin{equation*}
  \vVariable(\event) =
    \begin{cases}
      0 & \text{if } \event = \var{healthy} \\
      1 & \text{if } \event = \var{infected}.
    \end{cases}
\end{equation*}
%
Thus, $\pr{\vVariable[i]}[t] = \vScore_t$ is a risk score of \indexed{i}{individual}. A \define{factor node} 
%
\begin{equation*}
  \vFactor: \vVariables \times \vVariables \rightarrow [0, 1]
\end{equation*}
%
defines the transmission of infection risk between two contacts. Specifically, contact between \twoindexed{i}{j}{individual} is represented by the factor node $\vFactor(\vVariable[i], \vVariable[j])$ = $\vFactor[ij]$, which is adjacent to the variable nodes $\vVariable[i], \vVariable[j]$. This work and \citet{Ayday2021} assume risk transmission is a symmetric function, $\vFactor[ij] = \vFactor[ji]$. However, it may be extended to account for an individual's susceptibility and transmissibility such that $\vFactor[ij] \neq \vFactor[ji]$. \Cref{fig:factor-graph} depicts a factor graph that reflects the domain constraints.
%
\begin{figure}[htbp]
  \centering
  \begin{tikzpicture}[ampersand replacement=\&]
    \matrix[row sep=1.5em, column sep=0.75em] {
      \& \factor[minimum size=1em] {f12} {above:$\vFactor[12]$} {} {}; \&\&
      \factor[minimum size=1em] {f23} {above:$\vFactor[23]$} {} {}; \& \\
      \node[latent, minimum size=2em] (v1) {$\vVariable[1]$}; \&\&
      \node[latent, minimum size=2em] (v2) {$\vVariable[2]$}; \&\&
      \node[latent, minimum size=2em] (v3) {$\vVariable[3]$}; \\
    };
    \edge[-] {v1} {f12};
    \edge[-] {v2} {f12};
    \edge[-] {v2} {f23};
    \edge[-] {v3} {f23};
  \end{tikzpicture}
  \caption[Factor graph]{A factor graph of 3 variable nodes and 2 factor nodes.}
  \label{fig:factor-graph}
\end{figure}