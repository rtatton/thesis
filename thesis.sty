\ProvidesPackage{thesis}

% GENERAL

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}

\usepackage[margin=1.5in]{geometry}

% Adjust line spacing
\usepackage{setspace}
\doublespacing

% Block quote formatting
\usepackage{csquotes}

% Hyphenation
\usepackage{hyphenat}

% Provides NewDocumentCommand and NewDocumentEnvironment 
\usepackage{xparse}

% Math symbols and fonts
\usepackage{amsmath, amssymb, amsfonts}

% Convenience commands for proper bracket formatting
\usepackage{braket}

% Customize itemize and enumerate environments 
\usepackage{enumitem}

% Set section depth to paragraph level
\setcounter{secnumdepth}{4}

% Citations and cross-referencing
\usepackage[hidelinks, hypertexnames=false]{hyperref}

 % Bibliography citations
\usepackage[sort&compress, round]{natbib}

% Uncomment to find unused references
%\usepackage{refcheck}

% Add support for hyperlinked URLs and DOIs
\usepackage{url, doi}

% Unified cross-referencing for figures, tables, and equations
\usepackage[nameinlink, noabbrev]{cleveref}
\newcommand\crefconjunction{\textendash}
\crefformat{equation}{(#2#1#3)}

% SI unit formatting
\usepackage{siunitx}

% Specifies how to format key terms in text
\newcommand{\define}[1]{\emph{#1}}

% Add appendices to the table of contents
\usepackage[titletoc]{appendix}

% TABLES AND FIGURES
\usepackage{booktabs}

\usepackage{tabularx}

\usepackage{multirow}

\newcommand{\rowgroup}[1]{\hspace{-1em}#1}

\usepackage{subcaption}
\captionsetup{labelfont=bf}

\usepackage{tikz}
\graphicspath{{assets/}}
\usetikzlibrary{bayesnet, plotmarks, calc, angles, quotes, arrows}

% If using Texifier, use LuaLaTex and disable 'Hide intermediate files'.
\usepackage{pgfplots}
\usepgfplotslibrary{groupplots, statistics}
\pgfplotsset{
  compat=1.9,
  colormap={black}{gray=(0) gray=(0)},
  table/search path={./assets/},
  only if/.style args={entry of #1 is #2}{
    /pgfplots/boxplot/data filter/.code={
    	\edef\tempa{\thisrow{#1}}
    	\edef\tempb{#2}
    	\ifx\tempa\tempb
    	\else
    	\def\pgfmathresult{}
    	\fi
    }
  }
}

% ALGORITHM AND PSEUDOCODE

% \indexed{index}{value}
\newcommand{\indexed}[2]{the $#1$-th #2}
\newcommand{\Indexed}[2]{The $#1$-th #2}
\newcommand{\twoindexed}[3]{the $#1$-th and $#2$-th #3}

\usepackage[plain, boxed]{algorithm}

% Provides good formatting and \Call command
\usepackage[noend]{algpseudocode}

% Ensures proper hyperlinking of pseudocode procedures
\usepackage{hypcap}

%  Allow \Call to be nested
\MakeRobust{\Call}

\let\Algorithm\algorithm
\renewcommand\algorithm[1][]{\Algorithm[#1]\setstretch{1.5}}

% Remove "do" from for loop and "then" from if-else statements.
\newbox\fixbox
\renewcommand{\algorithmicdo}{\setbox\fixbox\hbox{\ {} }\hskip-\wd\fixbox}
\renewcommand{\algorithmicthen}{\setbox\fixbox\hbox{\ {} }\hskip-\wd\fixbox}

% For-each loop construct
\algnewcommand\algorithmicforeach{\textbf{for each}}
\algdef{S}[FOR]{ForEach}[1]{\algorithmicforeach\ #1\ \algorithmicdo}

% Boolean operators
\algnewcommand{\OR}{\textbf{ or }}
\algnewcommand{\AND}{\textbf{ and }}

% Pseudocode variable
\algnewcommand{\var}{\mathit}

% Pseudocode object attribute

% Assignment and equality
\newcommand{\assign}{\leftarrow}
\newcommand{\equals}{=}
\newcommand{\notEquals}{\neq}

% Constants
\newcommand{\nil}{\textsc{nil}}
\newcommand{\true}{\textsc{true}}
\newcommand{\false}{\textsc{false}}

% Usage:
%	\begin{function}[position]{title}[args]
%	...
%	\end{function}
\newcommand{\Title}[2]{\item[$\Call{#1}{#2}$]}
\NewDocumentEnvironment{function}{O{ht!} m O{}}{
	\begin{algorithm}[#1]
   	\label{#1}
	\capstart
    \captionlistentry{\Call{#2}{}}
   	\begin{algorithmic}[1]
   	\Title{#2}{#3}
}{
	\end{algorithmic}
	\end{algorithm}
}

% PSEUDOCODE and MATH SYMBOLS

\newcommand{\vSet}[1]{#1}

% Variables
\newcommand{\vActor}{A}
\newcommand{\vCacheItem}{x}
\newcommand{\vCache}{C}
\newcommand{\vContacts}{\vSet{C}}
\newcommand{\vContact}{c}
\newcommand{\vEdges}{\vSet{E}}
\newcommand{\vFactors}{\vSet{F}}
\newcommand{\vGraph}{G}
\newcommand{\vInfluenceSet}{I}
\newcommand{\vMsg}{m}
\newcommand{\vNeighbors}{\vSet{N}}
\newcommand{\vNewScore}{s'}
\newcommand{\vNew}[1]{#1_{\textit{new}}}
\newcommand{\vOldest}{\var{oldest}}
\newcommand{\vOld}[1]{#1_{\textit{old}}}
\newcommand{\vPathSet}{P}
\newcommand{\vReachRatio}{f}
\newcommand{\vRefTime}{\tau}
\newcommand{\vScoreValue}{r}
\newcommand{\vScores}{\vSet{S}}
\newcommand{\vScore}{s}
\newcommand{\vSomeElement}{x}
\newcommand{\vSomeSet}{\vSet{X}}
\newcommand{\vSourceSet}{S}
\newcommand{\vVariables}{\vSet{V}}

\newcommand{\vOldCacheItem}{\vOld{\vCacheItem}}
\newcommand{\vNewCacheItem}{\vNew{\vCacheItem}}

\newcommand{\vEstMsgReach}{\hat{\vMsgReach}}
\newcommand{\vInitScoreValue}{\vScoreValue_0}
\newcommand{\vMsgInfluenceSet}{\vInfluenceSet_\vMsg}
\newcommand{\vMsgReachRatio}{\vReachRatio_\vMsg}
\newcommand{\vMsgReach}{\vMsg}
\newcommand{\vMsgSourceSet}{\vSourceSet_\vMsg}
\newcommand{\vPath}[2]{#1 \rightarrow #2}
\NewDocumentCommand{\vVariable}{o}{\IfValueTF{#1}{v_{#1}}{v}}
\NewDocumentCommand{\vFactor}{o}{\IfValueTF{#1}{f_{#1}}{f}}
\newcommand{\vScoreMsg}[2]{\vMsg_{#1 \rightarrow #2}}
\newcommand{\vVariableMsg}[3]{\mu_{#1#2}^{(#3)}}
\newcommand{\vFactorMsg}[3]{\lambda_{#1#2}^{(#3)}}

% Parameters
\newcommand{\pDuration}{T}
\newcommand{\pNumActors}{K}
\newcommand{\pSendCoeff}{\gamma}
\newcommand{\pTimeBuffer}{\beta}
\newcommand{\pTimeout}{T}
\newcommand{\pTransRate}{\alpha}
\newcommand{\pTtl}{\pDuration}
\newcommand{\pMinContactDuration}{\delta}

\newcommand{\pContactTtl}{\pTtl_\vContact}
\newcommand{\pScoreTtl}{\pTtl_\vScore}

% Attributes
\algnewcommand{\attr}[2]{#1.\var{#2}}

\newcommand{\aContacts}[1]{\attr{#1}{contacts}}
\newcommand{\aContact}[1]{\attr{#1}{contact}}
\newcommand{\aEnd}[1]{\attr{#1}{end}}
\newcommand{\aExpiry}[1]{\attr{#1}{expiry}}
\newcommand{\aKey}[1]{\attr{#1}{key}}
\newcommand{\aName}[1]{\attr{#1}{name}}
\newcommand{\aRefresh}[1]{\attr{#1}{refresh}}
\newcommand{\aScores}[1]{\attr{#1}{scores}}
\newcommand{\aScore}[1]{\attr{#1}{score}}
\newcommand{\aSender}[1]{\attr{#1}{sender}}
\newcommand{\aStart}[1]{\attr{#1}{start}}
\newcommand{\aThreshold}[1]{\attr{#1}{threshold}}
\newcommand{\aTime}[1]{\attr{#1}{time}}
\newcommand{\aValue}[1]{\attr{#1}{value}}

\newcommand{\aActorContacts}{\aContacts{\vActor}}
\newcommand{\aActorName}{\aName{\vActor}}
\newcommand{\aActorScoreValue}{\aValue{\aScore{\vActor}}}
\newcommand{\aActorScores}{\aScores{\vActor}}
\newcommand{\aActorScore}{\aScore{\vActor}}
\newcommand{\aContactKey}{\aKey{\vContact}}
\newcommand{\aContactName}{\aName{\vContact}}
\newcommand{\aContactThreshold}{\aThreshold{\vContact}}
\newcommand{\aContactTime}{\aTime{\vContact}}
\newcommand{\aNewScoreValue}{\aValue{\vNewScore}}
\newcommand{\aScoreExpiry}{\aExpiry{\vScore}}
\newcommand{\aScoreKey}{\aKey{\vScore}}
\newcommand{\aScoreSender}{\aSender{\vScore}}
\newcommand{\aScoreTime}{\aTime{\vScore}}
\newcommand{\aScoreValue}{\aValue{\vScore}}

% Function names
\newcommand{\nBecome}{Become}
\newcommand{\nCacheInsert}{Cache-Insert}
\newcommand{\nCacheKey}{Cache-Key}
\newcommand{\nCacheMax}{Cache-Max}
\newcommand{\nCacheRefresh}{Cache-Refresh}
\newcommand{\nContactTtl}{Contact-Ttl}
\newcommand{\nCreate}{Create}
\newcommand{\nNullRiskScore}{Null-Risk-Score}
\newcommand{\nDelete}{Delete}
\newcommand{\nGenerateName}{Generate-Name}
\newcommand{\nHandleContactMessage}{Handle-Contact-Message}
\newcommand{\nHandleScoreMessage}{Handle-Risk-Score-Message}
\newcommand{\nInitializeActor}{Initialize-Actor}
\newcommand{\nInsert}{Insert}
\newcommand{\nMaximum}{Maximum}
\newcommand{\nMerge}{Merge}
\newcommand{\nMinimum}{Minimum}
\newcommand{\nPredicate}{Predicate}
\newcommand{\nPropagate}{Propagate}
\newcommand{\nRefreshThreshold}{Refresh-Threshold}
\newcommand{\nScoreTtl}{Score-Ttl}
\newcommand{\nSearch}{Search}
\newcommand{\nSend}{Send}
\newcommand{\nSetThreshold}{Set-Threshold}
\newcommand{\nShouldReceive}{Should-Receive}
\newcommand{\nRiskPropagation}{Risk-Propagation}
\newcommand{\nUpdateExposureScore}{Update-Exposure-Score}

% Function calls

\newcommand{\cBecome}[1][]{\Call{\nBecome}{#1}}
\newcommand{\cCacheInsert}[1][]{\Call{\nCacheInsert}{#1}}
\newcommand{\cCacheKey}[1][]{\Call{\nCacheKey}{#1}}
\newcommand{\cCacheMax}[1][]{\Call{\nCacheMax}{#1}}
\newcommand{\cCacheRefresh}[1][]{\Call{\nCacheRefresh}{#1}}
\newcommand{\cContactTtl}[1][]{\Call{\nContactTtl}{#1}}
\newcommand{\cCreateActor}[1][]{\Call{\nInitializeActor}{#1}}
\newcommand{\cCreate}[1][]{\Call{\nCreate}{#1}}
\newcommand{\cNullRiskScore}[1][]{\Call{\nNullRiskScore}{#1}}
\newcommand{\cDelete}[1][]{\Call{\nDelete}{#1}}
\newcommand{\cGenerateName}[1][]{\Call{\nGenerateName}{#1}}
\newcommand{\cHandleContactMessage}[1][]{\Call{\nHandleContactMessage}{#1}}
\newcommand{\cHandleScoreMessage}[1][]{\Call{\nHandleScoreMessage}{#1}}
\newcommand{\cInsert}[1][]{\Call{\nInsert}{#1}}
\newcommand{\cMaximum}[1][]{\Call{\nMaximum}{#1}}
\newcommand{\cMerge}[1][]{\Call{\nMerge}{#1}}
\newcommand{\cMinimum}[1][]{\Call{\nMinimum}{#1}}
\newcommand{\cPredicate}[1][]{\Call{\nPredicate}{#1}}
\newcommand{\cPropagate}[1][]{\Call{\nPropagate}{#1}}
\newcommand{\cRefreshThreshold}[1][]{\Call{\nRefreshThreshold}{#1}}
\newcommand{\cScoreTtl}[1][]{\Call{\nScoreTtl}{#1}}
\newcommand{\cSearch}[1][]{\Call{\nSearch}{#1}}
\newcommand{\cSend}[1][]{\Call{\nSend}{#1}}
\newcommand{\cSetThreshold}[1][]{\Call{\nSetThreshold}{#1}}
\newcommand{\cShouldReceive}[1][]{\Call{\nShouldReceive}{#1}}
\newcommand{\cRiskPropagation}[1][]{\Call{\nRiskPropagation}{#1}}
\newcommand{\cUpdateExposureScore}[1][]{\Call{\nUpdateExposureScore}{#1}}

% Standard number sets
\newcommand{\reals}{\mathbb{R}} 
\newcommand{\naturals}{\mathbb{N}}

% Math functions
\DeclareMathOperator{\aeMsgReachRatio}{mrr}
\DeclareMathOperator{\argmax}{\arg\max}
\DeclareMathOperator{\hav}{hav}
\DeclareMathOperator{\vers}{vers}
\newcommand{\card}[1]{\left\vert #1 \right\vert}
\newcommand{\ceil}[1]{\left\lceil #1 \right\rceil}
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}
\newcommand{\setBuilder}[2]{\set{ #1 | #2}}
\newcommand{\SetBuilder}[2]{\Set{ #1 | #2}}
\newcommand{\ltwodots}{\mathinner {\ldotp \ldotp}}

% TABLE OF CONTENTS
\usepackage[nottoc]{tocbibind}
\renewcommand{\listalgorithmname}{List of Functions}
\setcounter{tocdepth}{2}