\ProvidesPackage{thesis}

% GENERAL

\usepackage[utf8]{inputenc}

\usepackage[margin=1.5in]{geometry}

% Adjust line spacing
\usepackage{setspace}
\doublespacing

% Block quote formatting
\usepackage{csquotes}

% Hyphenation
\usepackage{hyphenat}

% Provides NewDocumentCommand and NewDocumentEnvironment 
\usepackage{xparse}

% Math symbols and fonts
\usepackage{amsmath, amssymb, amsfonts}

% Customize itemize and enumerate environments 
\usepackage{enumitem}

% SI unit formatting
\usepackage{siunitx}

% Use to define key terms in-text
\newcommand{\define}[1]{\emph{#1}}


% TABLE OF CONTENTS

\usepackage[nottoc]{tocbibind}

% Include subsections in the table of contents
\setcounter{tocdepth}{2}

% Number sections down to subsections
\setcounter{secnumdepth}{3}

% Add appendices to the table of contents
\usepackage[titletoc]{appendix}

% CROSS REFERENCING

% Citations and cross-referencing
\usepackage[hidelinks]{hyperref}

 % Bibliography citations
\usepackage[sort&compress, round]{natbib}

% Uncomment to find unused references
%\usepackage{refcheck}

% Add support for hyperlinked URLs and DOIs
\usepackage{url, doi}

% Unified cross-referencing for figures, tables, and equations
\usepackage[nameinlink, noabbrev]{cleveref}
\newcommand{\crefconjunction}{\textendash}
\crefformat{equation}{(#2#1#3)}


% TABLES AND FIGURES

% TODO Remove?
\usepackage{booktabs}

% TODO Remove?
\usepackage{tabularx}

% TODO Remove?
\usepackage{multirow}

% TODO Remove?
\newcommand{\rowgroup}[1]{\hspace{-1em}#1}

\usepackage{subcaption}
\captionsetup{labelfont=bf}

\usepackage{tikz}
\graphicspath{{assets/}}
\usetikzlibrary{bayesnet, plotmarks, calc, angles, quotes, arrows}

% If using Texifier, use LuaLaTex and disable 'Hide intermediate files'.
\usepackage{pgfplots}
\usepgfplotslibrary{groupplots, statistics}
\pgfplotsset{
  compat=1.9,
  colormap={black}{gray=(0) gray=(0)},
  table/search path={./assets/},
  only if/.style args={entry of #1 is #2}{
    /pgfplots/boxplot/data filter/.code={
    	\edef\tempa{\thisrow{#1}}
    	\edef\tempb{#2}
    	\ifx\tempa\tempb
    	\else
    	\def\pgfmathresult{}
    	\fi
    }
  }
}

% ALGORITHM AND PSEUDOCODE

\newcommand{\indexed}[2]{the $#1$-th #2}
\newcommand{\Indexed}[2]{The $#1$-th #2}
\newcommand{\twoindexed}[3]{the $#1$-th and $#2$-th #3}

\usepackage[plain, boxed]{algorithm}

% Provides good formatting and \Call command
\usepackage[noend]{algpseudocode}

% Ensures proper hyperlinking of pseudocode procedures
\usepackage{hypcap}

%  Allow \Call to be nested
\MakeRobust{\Call}

\let\Algorithm\algorithm
\renewcommand\algorithm[1][]{\Algorithm[#1]\setstretch{1.5}}

% Remove "do" from for loop and "then" from if-else statements.
\newbox\fixbox
\renewcommand{\algorithmicdo}{\setbox\fixbox\hbox{\ {} }\hskip-\wd\fixbox}
\renewcommand{\algorithmicthen}{\setbox\fixbox\hbox{\ {} }\hskip-\wd\fixbox}

% For-each loop construct
\algnewcommand\algorithmicforeach{\textbf{for each}}
\algdef{S}[FOR]{ForEach}[1]{\algorithmicforeach\ #1\ \algorithmicdo}

% Boolean operators
\algnewcommand{\OR}{\textbf{ or }}
\algnewcommand{\AND}{\textbf{ and }}

% Pseudocode variable
\algnewcommand{\var}{\mathit}

% Pseudocode object attribute

% Assignment and equality
\newcommand{\assign}{\leftarrow}
\newcommand{\equals}{=}
\newcommand{\notEquals}{\neq}

% Constants
\newcommand{\nil}{\textsc{nil}}

% Usage:
%   \begin{function}[position]{title}[args]
%     ...
%   \end{function}
\newcommand{\Title}[2]{\item[$\Call{#1}{#2}$]}
\NewDocumentEnvironment{function}{O{ht!} m O{}}{
  \begin{algorithm}[#1]
    \label{#1}
    \capstart
    \captionlistentry{\Call{#2}{}}
    \begin{algorithmic}[1]
      \Title{#2}{#3}
}{
    \end{algorithmic}
  \end{algorithm}
}

% PSEUDOCODE and MATH SYMBOLS

% Variables
\newcommand{\vActor}{a}
\newcommand{\vCacheItem}{x}
\newcommand{\vCache}{C}
\newcommand{\vContact}{c}
\newcommand{\vGraph}{G}
\newcommand{\vVertex}{v}
\newcommand{\vSourceVertex}{u}
\newcommand{\vTargetVertex}{v}
\newcommand{\vMessage}{m}
\newcommand{\vReachabilityRatio}{\rho}
\newcommand{\vReferenceTime}{\tau}
\newcommand{\vScore}{s}
\newcommand{\vSomeElement}{x}
\newcommand{\vReachability}{r}
\newcommand{\vTime}{t}

\NewDocumentCommand{\vVariable}{o}{\IfValueTF{#1}{x_{#1}}{x}}
\NewDocumentCommand{\vFactor}{o}{\IfValueTF{#1}{f_{#1}}{f}}
\newcommand{\vVariableMessage}[3]{\mu_{#1#2}^{(#3)}}
\newcommand{\vFactorMessage}[3]{\lambda_{#1#2}^{(#3)}}

\newcommand{\vNewScore}{\vScore'}
\newcommand{\vInitScore}{\vScore_0}
\newcommand{\vEstimatedReachability}{\hat{\vReachability}}

% Sets
\newcommand{\vSet}[1]{#1}

\newcommand{\vContacts}{\vSet{C}}
\newcommand{\vVertices}{\vSet{V}}
\newcommand{\vEdges}{\vSet{E}}
\newcommand{\vFactors}{\vSet{F}}
\newcommand{\vNeighbors}{\vSet{N}}
\newcommand{\vSomeSet}{\vSet{X}}
\newcommand{\vVariables}{\vSet{X}}
\newcommand{\vScores}{\vSet{S}}
\newcommand{\vSourceSet}{\vSet{S}}
\newcommand{\vInfluenceSet}{\vSet{I}}
\newcommand{\vFactorMessages}{\varLambda}
\newcommand{\vPath}{\vSet{P}}

% Parameters
\newcommand{\pDuration}{T}
\newcommand{\pNumActors}{K}
\newcommand{\pSendCoefficient}{\gamma}
\newcommand{\pTimeBuffer}{\beta}
\newcommand{\pTimeout}{T}
\newcommand{\pTransmissionRate}{\alpha}
\newcommand{\pExpiry}{\pDuration}
\newcommand{\pMinContactDuration}{\delta}

\newcommand{\pContactExpiry}{\pExpiry_\vContact}
\newcommand{\pScoreExpiry}{\pExpiry_\vScore}

% Attributes
\algnewcommand{\attr}[2]{#1.\var{#2}}

\newcommand{\aBuffered}[1]{\attr{#1}{buffered}}
\newcommand{\aContacts}[1]{\attr{#1}{contacts}}
\newcommand{\aKey}[1]{\attr{#1}{key}}
\newcommand{\aName}[1]{\attr{#1}{name}}
\newcommand{\aScores}[1]{\attr{#1}{scores}}
\newcommand{\aExposure}[1]{\attr{#1}{exposure}}
\newcommand{\aSender}[1]{\attr{#1}{sender}}
\newcommand{\aThreshold}[1]{\attr{#1}{threshold}}
\newcommand{\aTime}[1]{\attr{#1}{time}}
\newcommand{\aValue}[1]{\attr{#1}{value}}

\newcommand{\aActorContacts}{\aContacts{\vActor}}
\newcommand{\aActorName}{\aName{\vActor}}
\newcommand{\aActorExposure}{\aExposure{\vActor}}
\newcommand{\aActorExposureValue}{\aValue{\aExposure{\vActor}}}
\newcommand{\aActorScores}{\aScores{\vActor}}
\newcommand{\aContactBuffered}{\aBuffered{\vContact}}
\newcommand{\aContactKey}{\aKey{\vContact}}
\newcommand{\aContactName}{\aName{\vContact}}
\newcommand{\aContactThreshold}{\aThreshold{\vContact}}
\newcommand{\aContactThresholdValue}{\aValue{\aContactThreshold}}
\newcommand{\aContactTime}{\aTime{\vContact}}
\newcommand{\aNewScoreValue}{\aValue{\vNewScore}}
\newcommand{\aScoreKey}{\aKey{\vScore}}
\newcommand{\aScoreSender}{\aSender{\vScore}}
\newcommand{\aScoreTime}{\aTime{\vScore}}
\newcommand{\aScoreValue}{\aValue{\vScore}}

% Function names
\newcommand{\nBecome}{Become}
\newcommand{\nMaximumOlderThan}{Maximum-Older-Than}
\newcommand{\nContactTtl}{Contact-Ttl}
\newcommand{\nCreate}{Create}
\newcommand{\nCreateFactorGraph}{Create-Factor-Graph}
\newcommand{\nNullRiskScore}{Null-Risk-Score}
\newcommand{\nDelete}{Delete}
\newcommand{\nGenerateName}{Generate-Name}
\newcommand{\nHandleContact}{Handle-Contact}
\newcommand{\nHandleFlushTimeout}{Handle-Flush-Timeout}
\newcommand{\nHandleRiskScore}{Handle-Risk-Score}
\newcommand{\nCreateActor}{Create-Actor}
\newcommand{\nInsert}{Insert}
\newcommand{\nMaximum}{Maximum}
\newcommand{\nMerge}{Merge}
\newcommand{\nMinimum}{Minimum}
\newcommand{\nPredicate}{Predicate}
\newcommand{\nUpdateSendThreshold}{Update-Send-Threshold}
\newcommand{\nRiskScoreTtl}{Risk-Score-Ttl}
\newcommand{\nSearch}{Search}
\newcommand{\nSend}{Send}
\newcommand{\nApplyRiskScore}{Apply-Risk-Score}
\newcommand{\nSetSendThreshold}{Set-Send-Threshold}
\newcommand{\nRiskPropagation}{Risk-Propagation}
\newcommand{\nUpdateExposureScore}{Update-Exposure-Score}

% Function calls
\newcommand{\cBecome}[1][]{\Call{\nBecome}{#1}}
\newcommand{\cContactTtl}[1][]{\Call{\nContactTtl}{#1}}
\newcommand{\cCreateActor}[1][]{\Call{\nCreateActor}{#1}}
\newcommand{\cCreateFactorGraph}[1][]{\Call{\nCreateFactorGraph}{#1}}
\newcommand{\cCreate}[1][]{\Call{\nCreate}{#1}}
\newcommand{\cNullRiskScore}[1][]{\Call{\nNullRiskScore}{#1}}
\newcommand{\cDelete}[1][]{\Call{\nDelete}{#1}}
\newcommand{\cGenerateName}[1][]{\Call{\nGenerateName}{#1}}
\newcommand{\cHandleContact}[1][]{\Call{\nHandleContact}{#1}}
\newcommand{\cHandleFlushTimeout}[1][]{\Call{\nHandleFlushTimeout}{#1}}
\newcommand{\cHandleRiskScore}[1][]{\Call{\nHandleRiskScore}{#1}}
\newcommand{\cInsert}[1][]{\Call{\nInsert}{#1}}
\newcommand{\cMaximum}[1][]{\Call{\nMaximum}{#1}}
\newcommand{\cMaximumOlderThan}[1][]{\Call{\nMaximumOlderThan}{#1}}
\newcommand{\cMerge}[1][]{\Call{\nMerge}{#1}}
\newcommand{\cMinimum}[1][]{\Call{\nMinimum}{#1}}
\newcommand{\cPredicate}[1][]{\Call{\nPredicate}{#1}}
\newcommand{\cUpdateSendThreshold}[1][]{\Call{\nUpdateSendThreshold}{#1}}
\newcommand{\cRiskScoreTtl}[1][]{\Call{\nRiskScoreTtl}{#1}}
\newcommand{\cSearch}[1][]{\Call{\nSearch}{#1}}
\newcommand{\cSend}[1][]{\Call{\nSend}{#1}}
\newcommand{\cApplyRiskScore}[1][]{\Call{\nApplyRiskScore}{#1}}
\newcommand{\cSetSendThreshold}[1][]{\Call{\nSetSendThreshold}{#1}}
\newcommand{\cRiskPropagation}[1][]{\Call{\nRiskPropagation}{#1}}
\newcommand{\cUpdateExposureScore}[1][]{\Call{\nUpdateExposureScore}{#1}}

% Standard number sets
\newcommand{\reals}{\mathbb{R}} 
\newcommand{\naturals}{\mathbb{N}}

% Probability theory
\NewDocumentCommand{\pr}{mo}{\IfValueTF{#2}{p_{#2}(#1)}{p(#1)}}
\newcommand{\eventSpace}{\Omega}
\newcommand{\event}{\omega}

% Math functions
\DeclareMathOperator{\aeMsgReachRatio}{mrr}
\DeclareMathOperator{\argmax}{\arg\max}
\DeclareMathOperator{\hav}{hav}
\DeclareMathOperator{\vers}{vers}
\newcommand{\card}[1]{\left\vert #1 \right\vert}
\newcommand{\ceil}[1]{\left\lceil #1 \right\rceil}
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}

% Convenience commands for proper bracket formatting
\usepackage{braket}
\newcommand{\setBuilder}[2]{\set{ #1 | #2}}
\newcommand{\SetBuilder}[2]{\Set{ #1 | #2}}

% Ref: https://tex.stackexchange.com/questions/304662/typesetting-an-integer-interval
\newcommand{\twodots}{\mathinner {\ldotp \ldotp}}